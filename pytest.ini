# https://docs.pytest.org/en/7.1.x/reference/reference.html#configuration-options

[pytest]
# https://docs.pytest.org/en/stable/how-to/doctest.html
# https://docs.pytest.org/en/stable/example/pythoncollection.html#ignore-paths-during-test-collection
addopts =
    --strict-markers --capture=no --tb=short
    --doctest-modules

# Directories to collect tests from (speeds up collection significantly)
# Note: tests/containers is ignored by default because it imports heavy modules
# (docker, kubernetes, testcontainers) that slow down collection by ~1.5s.
# Run container tests explicitly: pytest tests/containers --image=...
testpaths = tests ntb
collect_ignore = ["tests/containers"]

# https://docs.pytest.org/en/stable/example/pythoncollection.html#changing-directory-recursion
norecursedirs = .git .venv tmp node_modules __pycache__

# pytest-subtest plugin is built-in since pytest 9.0: https://docs.pytest.org/en/stable/how-to/subtests.html
required_plugins =

junit_logging = all
junit_log_passing_tests = False

log_cli = True
log_cli_date_format = %Y-%m-%d %H:%M:%S
log_cli_format = %(asctime)s %(levelname)s %(message)s
log_cli_level = INFO

log_file = logs/pytest-logs.txt
log_file_level = DEBUG

# https://docs.pytest.org/en/stable/example/markers.html#registering-markers
markers =
    openshift: requires openshift to run,
    cuda: requires cuda to run,
    rocm: requires rocm to run,
    buildonlytest: runs inside docker build,
